#!/bin/bash

set -e

HOSTNAME=$1
FILENAME=$2

if [ ! -d ~/.ssh ]; then
  mkdir -p ~/.ssh
  chmod 700 ~/.ssh
fi

if [ -f ${FILENAME} ]; then
  cat ${FILENAME} >~/.ssh/id_rsa
  chmod 600 ~/.ssh/id_rsa
fi

cat <<EOF >~/.ssh/config
Host git.nativecode.net
  IdentitiesOnly yes
  UserKnownHostsFile=/dev/null
  StrictHostKeyChecking no
  IdentityFile ~/.ssh/id_rsa
EOF

ssh-keyscan -H ${HOSTNAME} >>~/.ssh/known_hosts
